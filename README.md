# Semantic Release Github Action

[![GitHub Marketplace](https://img.shields.io/badge/Marketplace-CommandBox_Semantic_Release-blue.svg?colorA=24292e&colorB=0366d6&style=flat&longCache=true&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAM6wAADOsB5dZE0gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAERSURBVCiRhZG/SsMxFEZPfsVJ61jbxaF0cRQRcRJ9hlYn30IHN/+9iquDCOIsblIrOjqKgy5aKoJQj4O3EEtbPwhJbr6Te28CmdSKeqzeqr0YbfVIrTBKakvtOl5dtTkK+v4HfA9PEyBFCY9AGVgCBLaBp1jPAyfAJ/AAdIEG0dNAiyP7+K1qIfMdonZic6+WJoBJvQlvuwDqcXadUuqPA1NKAlexbRTAIMvMOCjTbMwl1LtI/6KWJ5Q6rT6Ht1MA58AX8Apcqqt5r2qhrgAXQC3CZ6i1+KMd9TRu3MvA3aH/fFPnBodb6oe6HM8+lYHrGdRXW8M9bMZtPXUji69lmf5Cmamq7quNLFZXD9Rq7v0Bpc1o/tp0fisAAAAASUVORK5CYII=)](https://github.com/marketplace/actions/commandbox-semantic-release)

Automate your package version and releases using [Semantic Release for CommandBox](https://github.com/commandbox-modules/commandbox-semantic-release).

## Usage

1. Add a `GH_TOKEN` repository secret containing a GitHub token
   1. This will be used for committing the git tags to the repository
2. Add a `FORGEBOX_TOKEN` repository secret containing a ForgeBox user token
   1. This will be used for pushing package versions to ForgeBox
3. Create a `release.yml` (or similarly-named) workflow file
4. Add the following steps to the workflow:

```yml
- uses: actions/checkout@v2
- name: Run Semantic Release
  uses: Ortus-Solutions/semantic-release-action@v1.1
  with:
    githubToken: ${{ secrets.GH_TOKEN }}
    forgeboxToken: ${{ secrets.FORGEBOX_TOKEN }}
    excludeCommit: ${{ github.event.head_commit.message }}
    branch: master
```

You'll want to tweak the `branch` argument to point to the main "release" branch, like `main` or `master`.

## Arguments

* `githubToken` - Access token for publishing a release to GitHub.
* `forgeboxToken` - Access token for publishing a release to Forgebox.
* `excludeCommit` - Don't run on commits with this commit message.
* `branch` - Branch on which to target a release. Probably 'master' or 'main'.
* `dryRun` - Do a dry run? Either 'true' or 'false'.
* `force` - Force a new release? Either 'true' or 'false'.
* `verbose` - Show verbose output and verbose errors. Either 'true' or 'false'.
* `plugins` - JSON object of semantic-release plugins to use for this release execution.

## Full Workflow Example

Use this as an example of a working `release.yml`.

**Highlights:**

1. This workflow will run on pushes to the `main` branch.
2. The workflow does not run on commits generated by Semantic Release
3. The `uses: actions/checkout@v2` step is required for interacting with repo files
4. Semantic Release will create a new release based on the `main` branch
5. We configure a custom set of plugins to enable support for the [Emoji Log commit standard](https://ahmadawais.com/emoji-log/).


```yml
name: Release

on:
  push:
    branches:
      - main

jobs:
  release:
    name: Semantic Release
    if: "!contains(github.event.head_commit.message, '__SEMANTIC RELEASE VERSION UPDATE__')"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: Ortus-Solutions/semantic-release-action@v1.1
        with:
          githubToken: ${{ secrets.GH_TOKEN }}
          forgeboxToken: ${{ secrets.FORGEBOX_TOKEN }}
          excludeCommit: ${{ github.event.head_commit.message }}
          branch: main
          plugins: '{ "VerifyConditions": "GitHubActionsConditionsVerifier@commandbox-semantic-release", "FetchLastRelease": "ForgeBoxReleaseFetcher@commandbox-semantic-release", "RetrieveCommits": "JGitCommitsRetriever@commandbox-semantic-release", "ParseCommit": "EmojiLogCommitParser@commandbox-semantic-release", "FilterCommits": "DefaultCommitFilterer@commandbox-semantic-release", "AnalyzeCommits": "EmojiLogCommitAnalyzer@commandbox-semantic-release", "VerifyRelease": "NullReleaseVerifier@commandbox-semantic-release", "GenerateNotes": "GitHubMarkdownNotesGenerator@commandbox-semantic-release", "UpdateChangelog": "FileAppendChangelogUpdater@commandbox-semantic-release", "CommitArtifacts": "GitHubArtifactsCommitter@commandbox-semantic-release", "PublishRelease": "ForgeBoxReleasePublisher@commandbox-semantic-release", "PublicizeRelease": "GitHubReleasePublicizer@commandbox-semantic-release" }'
```

## Changelog

### V1.1 12/01/2021

- Includes `commandbox-semantic-release@2.5.0` to resolve version numbering when using the Emoji Log commit standard.
### V1 - 09/23/2021

- Initial release

# License

The scripts and documentation in this project are released under the [MIT License](LICENSE)

## Code of Conduct

> :book: Do unto others as you would have them do to you - [Matthew 7:12](https://www.biblegateway.com/passage/?search=matthew+7%3A12&version=NIV)